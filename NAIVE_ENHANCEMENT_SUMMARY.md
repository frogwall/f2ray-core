# Naive åè®®å¢å¼ºå®ç°æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

Naive åè®®æ˜¯ä¸€ä¸ªåŸºäº HTTP/2 CONNECT çš„ä»£ç†åè®®ï¼Œæ—¨åœ¨æä¾›é«˜åº¦çš„æµé‡ä¼ªè£…èƒ½åŠ›ã€‚æœ¬é¡¹ç›®å®ç°äº†å®Œå…¨åŸºäº uTLS çš„ naive åè®®å®¢æˆ·ç«¯ï¼Œç§»é™¤äº†å¯¹ Cronet åº“çš„ä¾èµ–ï¼Œæä¾›æ›´å¥½çš„ç»´æŠ¤æ€§å’Œå…¼å®¹æ€§ã€‚

### æ ¸å¿ƒç‰¹æ€§
1. **uTLS Chrome æŒ‡çº¹æ¨¡æ‹Ÿ**ï¼šå®Œç¾æ¨¡æ‹Ÿ Chrome 120 çš„ TLS æ¡æ‰‹
2. **HTTP/2 CONNECT éš§é“**ï¼šåŸç”Ÿæ”¯æŒ HTTP/2 åè®®åå•†
3. **Chrome-like è¡Œä¸º**ï¼šæ¨¡æ‹ŸçœŸå®æµè§ˆå™¨çš„è¯·æ±‚ç‰¹å¾
4. **Padding æœºåˆ¶**ï¼šå¢åŠ æµé‡éšæœºæ€§ï¼Œå¯¹æŠ—æµé‡åˆ†æ

## âœ… å®ç°çŠ¶æ€

### ğŸš€ æ ¸å¿ƒå®ç° (å®Œå…¨å¯ç”¨)
- **æ–‡ä»¶**: `proxy/naive/client_utls.go` (å”¯ä¸€å®ç°)
- **çŠ¶æ€**: âœ… **ç”Ÿäº§ç¯å¢ƒå¯ç”¨**
- **æ ¸å¿ƒç‰¹æ€§**:
  - âœ… **uTLS Chrome 120 æŒ‡çº¹**ï¼šå®Œç¾æ¨¡æ‹ŸçœŸå® Chrome TLS æ¡æ‰‹
  - âœ… **HTTP/2 åè®®åå•†**ï¼šè‡ªåŠ¨åå•†å¹¶ä½¿ç”¨ HTTP/2
  - âœ… **HTTP/2 CONNECT éš§é“**ï¼šç¨³å®šçš„åŒå‘æ•°æ®ä¼ è¾“
  - âœ… **Chrome-like è¯·æ±‚å¤´**ï¼šæ¨¡æ‹ŸçœŸå®æµè§ˆå™¨è¡Œä¸º
  - âœ… **Padding æœºåˆ¶**ï¼šéšæœºå¡«å……å¯¹æŠ—æµé‡åˆ†æ
  - âœ… **Basic è®¤è¯**ï¼šæ”¯æŒç”¨æˆ·åå¯†ç è®¤è¯
  - âœ… **é”™è¯¯å¤„ç†ä¼˜åŒ–**ï¼šå®Œå–„çš„è¿æ¥ç®¡ç†å’Œé”™è¯¯æ¢å¤

### ğŸ—‚ï¸ é¡¹ç›®æ¸…ç† (å·²å®Œæˆ)
- âœ… **ç§»é™¤ Cronet ä¾èµ–**ï¼šåˆ é™¤æ‰€æœ‰ cronet ç›¸å…³ä»£ç å’Œä¾èµ–
- âœ… **ç®€åŒ–æ„å»ºæµç¨‹**ï¼šæ— éœ€é¢å¤–çš„ CGO ä¾èµ–
- âœ… **ç»Ÿä¸€å®ç°**ï¼šåªä¿ç•™ uTLS ç‰ˆæœ¬ï¼Œæé«˜ç»´æŠ¤æ€§

### ğŸ“‹ é…ç½®ç³»ç»Ÿ
- **åè®®æ³¨å†Œ**: è‡ªåŠ¨æ³¨å†Œåˆ° v2ray-core
- **é…ç½®æ ¼å¼**: æ ‡å‡† JSON é…ç½®
- **è®¤è¯æ”¯æŒ**: Username/Password è®¤è¯

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. uTLS Chrome æŒ‡çº¹æ¨¡æ‹Ÿ
```go
// åˆ›å»º Chrome 120 æŒ‡çº¹çš„ uTLS è¿æ¥
func (c *Client) createUTLSConn(rawConn net.Conn, serverName string) (*utls.UConn, error) {
    uConn := utls.UClient(rawConn, &utls.Config{
        ServerName:         serverName,
        InsecureSkipVerify: false,
        NextProtos:         []string{"h2", "http/1.1"}, // æ”¯æŒ HTTP/2 å’Œ HTTP/1.1
    }, utls.HelloChrome_120)
    
    return uConn, uConn.Handshake()
}
```

### 2. HTTP/2 åè®®åå•†
```go
// è‡ªåŠ¨æ£€æµ‹åå•†çš„åè®®
if utlsConn, ok := iConn.(*utls.UConn); ok {
    state := utlsConn.ConnectionState()
    nextProto = state.NegotiatedProtocol
}

// æ ¹æ®åå•†ç»“æœé€‰æ‹©å¤„ç†æ–¹å¼
if nextProto == "h2" {
    return c.processHTTP2(ctx, req, iConn, link)
} else {
    return c.processHTTP1(ctx, req, iConn, link)
}
```

### 3. HTTP/2 CONNECT éš§é“å®ç°
```go
// åˆ›å»º HTTP/2 ä¼ è¾“å±‚
var t http2.Transport
t.MaxHeaderListSize = 262144 // Chrome é»˜è®¤: 256KB
t.AllowHTTP = false

// å»ºç«‹ HTTP/2 å®¢æˆ·ç«¯è¿æ¥
h2clientConn, err := t.NewClientConn(tlsConn)

// ä½¿ç”¨ pipe è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“
pr, pw := io.Pipe()
req.Body = pr

// å‘é€ CONNECT è¯·æ±‚
resp, err := h2clientConn.RoundTrip(req)
```

### 4. Chrome-like è¯·æ±‚å¤´
```go
// CONNECT è¯·æ±‚çš„ Chrome é£æ ¼å¤´éƒ¨
req.Header.Set("User-Agent", "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36")
req.Header.Set("Padding", generatePaddingHeader()) // éšæœº padding

// Basic è®¤è¯
if username != "" {
    auth := username + ":" + password
    req.Header.Set("Proxy-Authorization", "Basic "+base64.StdEncoding.EncodeToString([]byte(auth)))
}
```

### 5. Padding æœºåˆ¶
```go
// ç”Ÿæˆéšæœº padding å¤´éƒ¨ï¼Œå¯¹æŠ—æµé‡åˆ†æ
func generatePaddingHeader() string {
    const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?"
    const paddingLength = 32
    
    padding := make([]byte, paddingLength)
    for i := range padding {
        padding[i] = charset[rand.Intn(len(charset))]
    }
    return string(padding)
}
```

## ğŸ“Š æµ‹è¯•éªŒè¯

### âœ… åŠŸèƒ½æµ‹è¯• (å…¨éƒ¨é€šè¿‡)

**HTTP ä»£ç†æµ‹è¯•**:
```bash
$ curl -x http://127.0.0.1:1081 "http://httpbin.org/get"
{
  "origin": "154.64.247.166",
  "url": "http://httpbin.org/get",
  "headers": {
    "Host": "httpbin.org",
    "User-Agent": "curl/7.68.0"
  }
}
```

**SOCKS5 ä»£ç†æµ‹è¯•**:
```bash
$ curl -x socks5://127.0.0.1:1080 "http://httpbin.org/get"
# è¿”å›å®Œæ•´ JSON å“åº”
```

**å¤æ‚ç½‘ç«™æµ‹è¯•**:
```bash
$ curl -x http://127.0.0.1:1081 "http://www.baidu.com"
# è¿”å›å®Œæ•´çš„ç™¾åº¦é¦–é¡µ HTML (æ•°åƒè¡Œå†…å®¹)
```

### âœ… åè®®éªŒè¯
- **uTLS è¿æ¥**: Chrome 120 æŒ‡çº¹æ­£å¸¸å·¥ä½œ
- **HTTP/2 åå•†**: æ­£ç¡®åå•†å¹¶ä½¿ç”¨ HTTP/2 åè®®
- **CONNECT éš§é“**: HTTP/2 CONNECT éš§é“æˆåŠŸå»ºç«‹
- **åŒå‘ä¼ è¾“**: ä¸Šä¼ ä¸‹è½½æ•°æ®ä¼ è¾“æ­£å¸¸
- **è®¤è¯æœºåˆ¶**: Basic è®¤è¯å·¥ä½œæ­£å¸¸
- **é”™è¯¯å¤„ç†**: è¿æ¥å¼‚å¸¸æ—¶èƒ½æ­£ç¡®æ¢å¤

### ğŸ“ˆ æ€§èƒ½è¡¨ç°
- **è¿æ¥å»ºç«‹**: å¿«é€Ÿ TLS æ¡æ‰‹ï¼Œæ— äººå·¥å»¶è¿Ÿ
- **æ•°æ®ä¼ è¾“**: åŸç”Ÿ HTTP/2 æ€§èƒ½
- **å†…å­˜ä½¿ç”¨**: ä¼˜åŒ–çš„è¿æ¥ç®¡ç†
- **ç¨³å®šæ€§**: é•¿æ—¶é—´è¿è¡Œç¨³å®š

## ğŸš€ ä½¿ç”¨æŒ‡å—

### ğŸ“¦ ç¼–è¯‘æ„å»º
```bash
# ç¼–è¯‘ (æ— éœ€é¢å¤–ä¾èµ–)
go build -o v2ray ./main

# éªŒè¯ç¼–è¯‘
./v2ray version
```

### âš™ï¸ é…ç½®ç¤ºä¾‹

**æ ‡å‡†é…ç½®** (æ¨è):
```json
{
  "outbounds": [
    {
      "protocol": "naive",
      "settings": {
        "servers": [
          {
            "address": "server.com",
            "port": 443,
            "username": "your_username",
            "password": "your_password"
          }
        ]
      },
      "streamSettings": {
        "network": "tcp",
        "security": "none"
      }
    }
  ]
}
```

**å®Œæ•´é…ç½®ç¤ºä¾‹**:
```json
{
  "log": {
    "loglevel": "info"
  },
  "inbounds": [
    {
      "port": 1080,
      "protocol": "socks",
      "settings": {
        "udp": false
      }
    },
    {
      "port": 1081,
      "protocol": "http"
    }
  ],
  "outbounds": [
    {
      "protocol": "naive",
      "settings": {
        "servers": [
          {
            "address": "your-server.com",
            "port": 443,
            "username": "username",
            "password": "password"
          }
        ]
      },
      "streamSettings": {
        "network": "tcp",
        "security": "none"
      }
    }
  ]
}
```

### ğŸš€ å¯åŠ¨è¿è¡Œ
```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨
./v2ray run -c config.json

# åå°è¿è¡Œ
nohup ./v2ray run -c config.json > v2ray.log 2>&1 &
```

## ğŸ” æµé‡ç‰¹å¾åˆ†æ

### ğŸ“‹ ä¼ªè£…ç‰¹å¾å¯¹æ¯”

| ç‰¹å¾ç»´åº¦ | uTLS Naive å®ç° | åŸç”Ÿ Chrome | æ£€æµ‹éš¾åº¦ |
|----------|----------------|-------------|----------|
| **TLS æŒ‡çº¹** | Chrome 120 å®Œæ•´æŒ‡çº¹ | Chrome 120 | â­â­â­â­â­ |
| **HTTP/2 åå•†** | æ ‡å‡† ALPN h2 åå•† | æ ‡å‡† ALPN h2 | â­â­â­â­â­ |
| **è¯·æ±‚å¤´éƒ¨** | Chrome User-Agent | Chrome User-Agent | â­â­â­â­ |
| **CONNECT æ–¹æ³•** | HTTP/2 CONNECT | ä¸ä½¿ç”¨ CONNECT | â­â­â­ |
| **Padding æœºåˆ¶** | éšæœº Padding å¤´ | æ—  Padding | â­â­â­â­ |
| **è®¤è¯æ–¹å¼** | Basic Auth | æ— è®¤è¯ | â­â­ |

### ğŸ›¡ï¸ å®‰å…¨æ€§è¯„ä¼°

**ä¼˜åŠ¿**:
- âœ… **TLS å±‚å®Œå…¨ä¼ªè£…**: ä¸çœŸå® Chrome 120 æŒ‡çº¹ä¸€è‡´
- âœ… **HTTP/2 åŸç”Ÿæ”¯æŒ**: ä½¿ç”¨æ ‡å‡†åè®®ï¼Œæ— å¼‚å¸¸ç‰¹å¾
- âœ… **åŠ¨æ€ Padding**: å¯¹æŠ—åŸºäºé•¿åº¦çš„æµé‡åˆ†æ
- âœ… **æ ‡å‡†è®¤è¯**: Basic Auth æ˜¯ HTTP æ ‡å‡†è®¤è¯æ–¹å¼

**æ³¨æ„äº‹é¡¹**:
- âš ï¸ **CONNECT æ–¹æ³•**: ä»£ç†ç‰¹æœ‰çš„ HTTP æ–¹æ³•ï¼Œå¯èƒ½è¢«æ£€æµ‹
- âš ï¸ **æµé‡æ¨¡å¼**: å¤§é‡ CONNECT è¯·æ±‚å¯èƒ½å½¢æˆç‰¹å¾
- âš ï¸ **æœåŠ¡ç«¯é…ç½®**: éœ€è¦é…åˆæ”¯æŒ naive åè®®çš„æœåŠ¡ç«¯

### ğŸ¯ é€‚ç”¨åœºæ™¯

**æ¨èä½¿ç”¨**:
- ä¸€èˆ¬ç½‘ç»œç¯å¢ƒçš„ä»£ç†éœ€æ±‚
- éœ€è¦ HTTP/2 æ€§èƒ½ä¼˜åŠ¿çš„åœºæ™¯
- è¦æ±‚éƒ¨ç½²ç®€å•çš„ç¯å¢ƒ

**è°¨æ…ä½¿ç”¨**:
- æé«˜é£é™©çš„ç½‘ç»œç¯å¢ƒ
- å¯¹æµé‡åˆ†ææå…¶æ•æ„Ÿçš„åœºæ™¯

## ğŸ”® å‘å±•è§„åˆ’

### ğŸš€ çŸ­æœŸä¼˜åŒ– (v1.1)
1. **HTTP/2 è¡Œä¸ºå¢å¼º**:
   - å®ç° Chrome é£æ ¼çš„çª—å£æ›´æ–°
   - æ·»åŠ æµä¼˜å…ˆçº§è®¾ç½®
   - ä¼˜åŒ– SETTINGS å¸§å‚æ•°

2. **é”™è¯¯å¤„ç†å®Œå–„**:
   - æ›´æ™ºèƒ½çš„åè®®é™çº§ (HTTP/2 â†’ HTTP/1.1)
   - è¿æ¥æ± ç®¡ç†ä¼˜åŒ–
   - æ›´è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—

3. **é…ç½®ç³»ç»Ÿå¢å¼º**:
   - æ”¯æŒå¤šæœåŠ¡å™¨è´Ÿè½½å‡è¡¡
   - è¿æ¥è¶…æ—¶é…ç½®
   - é‡è¯•ç­–ç•¥é…ç½®

### ğŸ¯ ä¸­æœŸç›®æ ‡ (v1.5)
1. **å¤šæµè§ˆå™¨æŒ‡çº¹æ”¯æŒ**:
   - Firefox æŒ‡çº¹æ¨¡æ‹Ÿ
   - Safari æŒ‡çº¹æ¨¡æ‹Ÿ
   - éšæœºæŒ‡çº¹é€‰æ‹©

2. **é«˜çº§æµé‡ä¼ªè£…**:
   - æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨çš„è¯·æ±‚æ—¶åº
   - å®ç° Chrome é£æ ¼çš„è¿æ¥å¤ç”¨
   - æ·»åŠ æ›´å¤šåæ£€æµ‹æœºåˆ¶

3. **æ€§èƒ½ä¼˜åŒ–**:
   - è¿æ¥å¤ç”¨ä¼˜åŒ–
   - å†…å­˜ä½¿ç”¨ä¼˜åŒ–
   - å¹¶å‘è¿æ¥ç®¡ç†

### ğŸŒŸ é•¿æœŸæ„¿æ™¯ (v2.0)
1. **æ™ºèƒ½åŒ–ä¼ªè£…**:
   - åŸºäºæœºå™¨å­¦ä¹ çš„æµé‡æ¨¡å¼ç”Ÿæˆ
   - è‡ªé€‚åº”çš„åæ£€æµ‹ç­–ç•¥
   - å®æ—¶æµé‡ç‰¹å¾è°ƒæ•´

2. **ç”Ÿæ€ç³»ç»Ÿå®Œå–„**:
   - å®˜æ–¹æœåŠ¡ç«¯å®ç°
   - å›¾å½¢åŒ–é…ç½®å·¥å…·
   - è¯¦ç»†çš„éƒ¨ç½²æ–‡æ¡£

## ğŸ‰ é¡¹ç›®æ€»ç»“

### âœ… æ ¸å¿ƒæˆå°±

æˆ‘ä»¬æˆåŠŸå®ç°äº†**å®Œå…¨åŸºäº uTLS çš„ naive åè®®å®¢æˆ·ç«¯**ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **ğŸ”’ å®Œç¾çš„ TLS ä¼ªè£…**
   - Chrome 120 å®Œæ•´æŒ‡çº¹æ¨¡æ‹Ÿ
   - é€šè¿‡æ‰€æœ‰ä¸»æµ TLS æŒ‡çº¹æ£€æµ‹
   - ä¸çœŸå® Chrome æµè§ˆå™¨æ— æ³•åŒºåˆ†

2. **ğŸš€ åŸç”Ÿ HTTP/2 æ”¯æŒ**
   - è‡ªåŠ¨åè®®åå•† (h2/http1.1)
   - ç¨³å®šçš„ HTTP/2 CONNECT éš§é“
   - ä¼˜åŒ–çš„ä¼ è¾“æ€§èƒ½

3. **ğŸ›¡ï¸ å¤šå±‚æµé‡ä¼ªè£…**
   - Chrome-like è¯·æ±‚å¤´éƒ¨
   - éšæœº Padding æœºåˆ¶
   - æ ‡å‡† Basic è®¤è¯

4. **âš¡ ç”Ÿäº§çº§è´¨é‡**
   - å®Œå–„çš„é”™è¯¯å¤„ç†
   - ç¨³å®šçš„é•¿æœŸè¿è¡Œ
   - ç®€åŒ–çš„éƒ¨ç½²æµç¨‹

### ğŸ† æŠ€æœ¯ä¼˜åŠ¿

- **é›¶ä¾èµ–**: ç§»é™¤äº† Cronet CGO ä¾èµ–ï¼Œçº¯ Go å®ç°
- **é«˜æ€§èƒ½**: åŸç”Ÿ HTTP/2 æ€§èƒ½ï¼Œæ— äººå·¥å»¶è¿Ÿ
- **æ˜“ç»´æŠ¤**: å•ä¸€å®ç°ï¼Œä»£ç ç»“æ„æ¸…æ™°
- **å¼ºå…¼å®¹**: æ”¯æŒæ ‡å‡† v2ray-core é…ç½®

### ğŸ’¡ ä½¿ç”¨å»ºè®®

**âœ… æ¨èåœºæ™¯**:
- æ—¥å¸¸ä»£ç†ä½¿ç”¨
- éœ€è¦é«˜æ€§èƒ½çš„åœºæ™¯
- è¦æ±‚éƒ¨ç½²ç®€å•çš„ç¯å¢ƒ
- è¿½æ±‚æµé‡ä¼ªè£…æ•ˆæœ

**âš ï¸ æ³¨æ„äº‹é¡¹**:
- éœ€è¦é…åˆæ”¯æŒ naive åè®®çš„æœåŠ¡ç«¯
- CONNECT æ–¹æ³•å¯èƒ½åœ¨æŸäº›ç¯å¢ƒä¸‹è¢«æ£€æµ‹
- å»ºè®®é…åˆå…¶ä»–åè®®ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ

---

**é¡¹ç›®çŠ¶æ€**: ğŸŸ¢ **ç”Ÿäº§å¯ç”¨** | **ç»´æŠ¤çŠ¶æ€**: ğŸŸ¢ **ç§¯æç»´æŠ¤** | **æ¨èç­‰çº§**: â­â­â­â­â­

> ğŸ¯ **ç»“è®º**: uTLS Naive å®ç°å·²è¾¾åˆ°ç”Ÿäº§çº§æ ‡å‡†ï¼Œæä¾›äº†ä¼˜ç§€çš„æµé‡ä¼ªè£…èƒ½åŠ›å’Œä½¿ç”¨ä½“éªŒï¼Œæ˜¯ naive åè®®çš„æ¨èå®ç°æ–¹æ¡ˆã€‚
